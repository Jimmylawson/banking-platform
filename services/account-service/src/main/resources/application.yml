server:
  port: 8081

spring:
  application:
    name: account-service

  config:
    import: "optional:configserver:http://localhost:8071"
    fail-fast: true

  resilience4j:
    circuitbreaker:
      configs:
        default:
          registerHealthIndicator: true
          slidingWindowType: COUNT_BASED      # or TIME_BASED
          slidingWindowSize: 4               # look at last 10 calls
          minimumNumberOfCalls: 4            # donâ€™t evaluate before this many
          failureRateThreshold: 50            # >=50% failures -> OPEN
          slowCallDurationThreshold: 2s       # calls slower than this are "slow"
          slowCallRateThreshold: 60           # >=60% slow calls -> OPEN
          waitDurationInOpenState: 10s        # stay OPEN before trying again
          permittedNumberOfCallsInHalfOpenState: 2
          automaticTransitionFromOpenToHalfOpenEnabled: true
          recordExceptions:
            - feign.RetryableException
            - feign.FeignException
            - java.net.SocketTimeoutException
            - java.io.IOException
      instances:
        customerService:
          baseConfig: default

  cloud:
    function:
      definition: handleCustomerCreated  # Matches your @Bean method name
    stream:
      bindings:
        handleCustomerCreated-in-0:  # Matches the function name + -in-0
          destination: customer.events  # Kafka topic to listen to
          group: account-service-group  # Consumer group
      kafka:
        binder:
          brokers: localhost:9092  # Kafka broker address


  eureka:
    client:
      register-with-eureka: true
      fetch-registry: true
      service-url:
        defaultZone: http://localhost:8761/eureka/

management:
  endpoint:
    prometheus:
      enabled: true
    metrics:
      tags:
        application: ${spring.application.name}
    health:
      show-details: always
      show-components: always
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: health,prometheus,info,metrics,circuitbreakers,circuitbreakerevents
  health:
    circuitbreakers:
      enabled: true
    defaults:
      show-details: always

#logging:
#  level:
#    org.springframework.boot.actuate: DEBUG
#    org.springframework.cloud: DEBUG
#    org.springframework.web: DEBUG
#    com.jimmyproject: DEBUG
#    io.github.resilience4j: DEBUG
